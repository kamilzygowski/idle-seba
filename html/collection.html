<div id="canvas-wrap">
    <canvas id='collection' width='1400px' height='720px' style='border:1px solid grey'></canvas>
    <div id='heroCard'>
        <div id="poppingWindow"><p id="windowText">  
        </p><button id="confirmButton"> confirm </button>
        <img id="xButton" src="images/closeButton.png">
        <img src="images/window.png"></div>
    </div>
</di>

<button id = 'randomHero' style="position: absolute; top:350px; left:500px;">RANDOM HERO</button>

<script>
    var canvas = document.getElementById('collection');
    var ctx = collection.getContext('2d');
    ctx.save();
    ctx.font = '24px Tahoma';
    var ownedHeros = [];
    //wszyscy dostepni na ten moment bohaterowie w gierce, bedzie trzeba pewnie gdzies w jakis stalych dac
    allHeros = [1,2,3,4];
    myHeros = [];

    async function cappa(){
        ctx.clearRect(0,0,collection.width, collection.height);
        console.log("PRZED ZEBRANIEM DANYCH");
        ownedHeros = await gameApp.getOwnedHeros();
        console.log("PO ZEBRANIU DANYCH");
        var request = new XMLHttpRequest();
        request.open("GET","json/hero.json", false);
        request.send(null);
        var herosInfo = JSON.parse(request.responseText);
        console.log(herosInfo[1].avatar);

        for(var i = 0; i < ownedHeros.length; i++){
            //sprawdzac id kazdego herosa i zamiast szarego kwadrata rysowac jego avatar
            createImage(i, herosInfo[ownedHeros[i]].avatar, herosInfo[ownedHeros[i]].name, herosInfo[ownedHeros[i]].id);
        }        
        
    }
    cappa();

    function createImage(i, src, name, id){   // load an image function 
                           // creates a new i each time it is called
        var image = new Image();  // create a new image variable 
        image.src = src;
        image.onload = function(){  // now the onload will have the correct variables 
            ctx.drawImage(image, 128*(i+1), 128, 128, 128); 
            ctx.fillText(name, 128*(i+1), 280);
            myHeros.push({
                "id": id,
                "x": 128*(i+1),
                "y": 128
            })
        } 
    }

    function closeWindow() {
        document.getElementById('heroCard').style.visibility = "hidden";
    };

    function openHeroCard(id){
            document.getElementById('heroCard').style.visibility = "visible";
            document.getElementById('xButton').addEventListener('click', closeWindow);
            document.getElementById('windowText').innerText = "tutaj beda staty bohatera o id: " + id;
            //heroCard.innerHTML = '';
           // heroCard.innerHTML += windows.poppingHeroCard;
            console.log('okienko pojawia sie');
    }

    var canvasPosition = canvas.getBoundingClientRect();
    console.log(canvasPosition);

    var mouse = {
        x: canvas.width/2,
        y: canvas.width/2,
        click: false
    }

    canvas.addEventListener('mousedown', function(event){
        mouse.x = event.x - canvasPosition.left;
        mouse.y = event.y - canvasPosition.top;
        console.log(mouse.x, mouse.y);
        checkClick(mouse.x, mouse.y);
    });

    function checkClick(x, y){
        var imgSize = 128;
        selectedHero = "nikt";
        console.log(myHeros);
        myHeros.forEach(hero => {
            console.log(hero);
            if (x >= hero.x && x <= hero.x + imgSize && y >= hero.y && y <= hero.y + imgSize){
               console.log("kliknales na bohatera o id: "+ hero.id);
               //tutaj otwiera sie okno ze statystykami bohatera gdzie przekazujemy id bohatera
               openHeroCard(hero.id);
            }
        });
        console.log(selectedHero);
    }

    document.getElementById("randomHero").addEventListener("click", function() {
        wylosujBohateraKtoregoNieMa();     
    },);



    async function wylosujBohateraKtoregoNieMa(){
        var notOwnedHeros = [];
        notOwnedHeros = allHeros.filter(n => !ownedHeros.includes(n));

        if (notOwnedHeros.length != 0){
            var newHero = notOwnedHeros[Math.floor(Math.random()*notOwnedHeros.length)];
            console.log(newHero);
            await gameApp.unlockHero(newHero);
            
        }
        else{
            alert("Juz masz wszystkich heros!");
        }

        cappa();
    }
</script>

<style>
    #canvas-wrap { position:relative } /* Make this a positioned parent */
    #heroCard { 
        position:absolute; 
        top:150px;  
        width: 1400px;
        height: 500px;
        align-items: center;
        justify-content: center;
        display:flex;
        visibility: hidden;
    }

    #poppingWindow {
        position: absolute;
        display: flex;
        justify-content: center;
        align-content: flex-end;
        width: 1200px;
        height: 650px;
    }

    /* #heroCard {
        width: 1400px;
        height: 500px;
        display:flex;
        align-items: center;
        justify-content: center;
        position:relative;
        background-color: aqua;
    } */

    #windowText {
        color: #fff;
        width: 840px;
        margin-top: 3%;
        font-size: 26px;
        position: absolute;
    }

    #confirmButton {
        position: absolute;
        width: 110px;
        height: 65px;
        margin-top: 50%;
        background: url(images/cofirmButton.png) no-repeat;

        color: #fff;

    }
    #xButton {
        position: absolute;
        width: 64px;
        height: 64px;
        margin-left: 85%;
        margin-bottom: 10%;
    }

    #xButton:hover {
        opacity: 0.7;
    }
</style>
