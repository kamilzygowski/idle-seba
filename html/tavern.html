<div id='tavernView'>
    <img id="gambler" src="images/Gambler1.png" style="position:absolute">
    <img id="blackMarket" src="images/blackMarket.png" style="position:absolute">
</div>


<canvas id='tavern' width='1400px' height='720px' style='border:1px solid grey'></canvas>
<script>


    var ctx = tavern.getContext('2d');
    ctx.font = '24px Tahoma';
    var tavernBackground = new Image;
    tavernBackground.src = 'images/tavern.png';

    var gamblerText = ['Eeey sst, listen to me, for a second. I heared that you are new here, for foreign visitors we have special offer, sit here!',
        'Lets roll some dices, ayeeee'];
    var blackMarketText = ['essasasasa'];

    var bet = playerMoney;

    var windows = {
        poppingWindowGambler: '<div id="poppingWindow"><p id="windowText"> ' + gamblerText[0] + '</p><button id="confirmButton"> confirm </button><img id="xButton' + '" src="images/closeButton.png"><img src=' + '"images/window.png"><p id="windowText2"> How much you want to bet: </p><p class="bet">' + setBet() + ' $</p><input type="range" min="1" max="100" value="0" class="slider" id="myRange"></div>',
        poppingWindowBlackMarket: '<div id="poppingWindow"><p id="windowText"> ' + blackMarketText[0] + '</p><button id="confirmButton"> confirm </button><img id="xButton' + '" src="images/closeButton.png"><img src=' + '"images/window.png"></div>'
    };

    var characters = {
        gamblerHTML: '<img id="' + 'gambler" ' + 'src="images/Gambler1.png"' + 'style="position:absolute">',
        blackMarketHTML: '<img id="' + 'blackMarket" ' + 'src="images/blackMarket.png"' + ' style="position:absolute">'
    };

    ctx.fillStyle = '#3498db';   //inny niebieski
    ctx.fillRect(0, 0, tavern.width, tavern.height);
    ctx.drawImage(tavernBackground, 0, 0, tavern.width, tavern.height);

    /* var text= "Siehehehema, mo≈ºe piwka?";
     ctx.fillStyle = "indigo";
     ctx.fillText(text, tavern.width/2 - 150, tavern.height/2); */

    var gambler = new Image,
        gambler2 = new Image,
        window = new Image,
        xButton = new Image;
    gambler.src = "images/Gambler1.png";
    gambler2.src = "images/Gambler2.png";
    window.src = "images/window.png";
    xButton.src = "images/closeButton.png";


    /* var gambleNPC = ctx.drawImage(gambler, 600, 300, gambler.width*2, gambler.height*2);*/

    var tavernDiv = document.getElementById('tavernView');
    tavernDiv.innerHTML += characters.gamblerHTML /*+ '<img src="' + 'images/window.png"' + ' width="133" ' + 'height="333"' + 'style=" position:absolute">'*/;
    // tavernDiv.innerHTML += windows.poppingWindowGambler;


    var gamblerObj = document.getElementById('gambler'),
        poppingWindowObj = document.getElementById('poppingWindow'),
        closeButtonObj = document.getElementById('xButton');

    var character_info;
    var playerMoney;

        async function get_my_profile_info() {
    character_info = await gameApp.getCharacterInfo();
    playerMoney = character_info.gold;
  }

    init();

    console.log(playerMoney);

    function returnToBasicState() {
        characters.gamblerHTML = '<img id="' + 'gambler" ' + 'src="images/Gambler1.png"' + 'style="position:absolute">';
        characters.blackMarketHTML = '<img id="' + 'blackMarket" ' + 'src="images/blackMarket.png"' + ' style="position:absolute">';
        tavernDiv.innerHTML = '';
        addAllNPCS();
        //console.log('returned');
    }

    function closeWindow() {
        tavernDiv.innerHTML = '';
        addAllNPCS();
        returnToBasicState();
        document.getElementById('gambler').addEventListener('mouseover', addGambler);
        document.getElementById('blackMarket').addEventListener('mouseover', addBlackMarket);
    };

    function addAllNPCS() {
        tavernDiv.innerHTML += characters.gamblerHTML;
        tavernDiv.innerHTML += characters.blackMarketHTML;
    }


    function addGambler() {

        characters.gamblerHTML = '<img id="' + 'gambler" ' + 'src="images/Gambler2.png"' + 'style="position:absolute">';
        tavernDiv.innerHTML = '';
        tavernDiv.innerHTML += characters.gamblerHTML;
        //ctx.drawImage(gambler2, 600, 300, gambler.width*2, gambler.height*2);

        characters.blackMarketHTML = '<img id="' + 'blackMarket" ' + 'src="images/blackMarket.png"' + ' style="position:absolute">';
        tavernDiv.innerHTML += characters.blackMarketHTML;

        document.getElementById('gambler').addEventListener('click', function () {
            tavernDiv.innerHTML = '';
            tavernDiv.innerHTML += windows.poppingWindowGambler;
            console.log('okienko pojawia sie');

            


            document.getElementById('xButton').addEventListener('click', closeWindow);
        });
    }
    

    function setBet(){
        var gamblerSlider = document.querySelector('.slider');

        if (gamblerSlider !== null){
            bet = Math.ceil(playerMoney * gamblerSlider.value/100);
            
        } else {
            bet = Math.ceil(playerMoney * 1/100);
        }

            return bet;

    }


    function addBlackMarket() {
        characters.blackMarketHTML = '<img id="' + 'blackMarket" ' + 'src="images/blackMarket2.png"' + ' style="position:absolute">';
        tavernDiv.innerHTML = '';
        addAllNPCS();

        document.getElementById('blackMarket').addEventListener('click', function () {
            tavernDiv.innerHTML = '';
            tavernDiv.innerHTML += windows.poppingWindowBlackMarket;
            console.log('okienko pojawia sie');

            document.getElementById('xButton').addEventListener('click', closeWindow);
        });
    }

    function init(){
    get_my_profile_info();
    returnToBasicState();
    }


    //closeButtonObj.addEventListener('click', closeWindow);
    setInterval(function () {
        if (document.getElementById('gambler') !== null) {
            document.getElementById('gambler').addEventListener('mouseenter', e => {
                addGambler();
                document.getElementById('gambler').addEventListener('mouseleave', returnToBasicState);
            });

        } 
        
        if (document.getElementById('blackMarket') !== null) {
            document.getElementById('blackMarket').addEventListener('mouseenter', e => {
                addBlackMarket();
                document.getElementById('blackMarket').addEventListener('mouseleave', returnToBasicState);
            });
        }

        var gamblerSlider = document.querySelector('.slider');
        if (gamblerSlider !== null){
        gamblerSlider.addEventListener('input',function(){
            tavernDiv.innerHTML = '<div id="poppingWindow"><p id="windowText"> ' + gamblerText[0] + '</p><button id="confirmButton"> confirm </button><img id="xButton' + '" src="images/closeButton.png"><img src=' + '"images/window.png"><p id="windowText2"> How much you want to bet: </p><p class="bet">' + setBet() + ' $</p><input type="range" min="1" max="100" value="' +gamblerSlider.value + '" class="slider" id="myRange"></div>';
            document.getElementById('xButton').addEventListener('click', closeWindow);
            
            });
        }
            

    });


    /* gamblerObj.addEventListener('click', function(){
         console.log('klik');
         //ctx.drawImage(window, tavern.width/2 - window.width/2, tavern.height/2 - window.height/2, widnow.width, widnow.height);
         ctx.drawImage(window,0, 0, window.width, window.height);
         ctx.drawImage(xButton, 22, 22, xButton.width, xButton.height);
     });*/

    /*setInterval(function(){
        tavernView.innerHTML = characters.gamblerHTML;
    }, 200);*/


   /* if(document.querySelector('.slider') !== null){
    gamblerSlider.addEventListener('click', setBet);
    console.log(setBet);
    } else {
        
    }
*/


</script>

<style>
    #gambler {
        display: flex;
        margin-left: 5%;
        margin-top: 26%;
        width:134px;
        height: 232px;

    }

    #blackMarket {
        display: flex;
        left: 850px;
        top: 233px;
        width: 120px;
        height: 238px;

    }

    #tavernView {
        width: 1400px;
        height: 720px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: absolute;
    }

    #poppingWindow {
        position: absolute;
        display: flex;
        justify-content: center;
        align-content: flex-end;
        width: 1050px;
        height: 650px;
    }

    #poppingWindow .active {
        display: flex;
    }

    #xButton {
        position: absolute;
        width: 64px;
        height: 64px;
        margin-left: 85%;
        margin-bottom: 10%;
    }

    #xButton:hover {
        opacity: 0.7;
    }

    #windowText {
        color: #fff;
        width: 840px;
        margin-top: 3%;
        font-size: 26px;
        position: absolute;
    }

    #windowText2 {
        color: #fff;
        width: 840px;
        margin-top: 15%;
        font-size: 26px;
        position: absolute;
        text-align: center;
    }

    .bet {
        color: lightgreen;
        width: 840px;
        margin-top: 15%;
        font-size: 26px;
        position: absolute;
        text-align: center; 
        margin-left: 35%;
    }

    #myRange {
        margin-top: 21%;
        margin-left: 0;
        width:42%;
        transition: opacity .2s;
        cursor: pointer;
        position: absolute;
    }

    #confirmButton {
        position: absolute;
        width: 110px;
        height: 65px;
        margin-top: 52%;
        background: url(images/cofirmButton.png) no-repeat;

        color: #fff;

    }
</style>