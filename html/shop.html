<div id='shopView' style="position:absolute; width:1400px; height:720px; ">
  <div class='itemDescription'>
    <p>Hover items to see stats here!</p>
  </div>
</div>
<canvas id='shop' width='1400px' height='720px' style='border:1px solid grey'></canvas>
<script>

  var items = [
    { id: '0', atk: '14', def: '4', spec: ' yikes ', price: 19, image: 'images/sword.png', name: 'Bread Sword' },
    { id: '1', atk: '1', def: '17', spec: ' def +2', price: 15, image: 'images/shield.png', name: 'Novice Shield' },
    { id: '2', atk: '31', def: '2', spec: ' smigielsky ', price: 24, image: 'images/spear.png', name: "Panda's Spear" }
  ];
  var ctx = shop.getContext('2d');
  var rng;
  var shopDiv = document.getElementById('shopView');
  var playerInventory;
  var slotWindow = [{ img: 'images/slotWindow.png', x: 580, y: 580, height: 96, width: 96 },
  { img: 'images/slotWindow.png', x: 690, y: 580, height: 96, width: 96 },
  { img: 'images/slotWindow.png', x: 800, y: 580, height: 96, width: 96 },
  { img: 'images/slotWindow.png', x: 910, y: 580, height: 96, width: 96 },
  { img: 'images/slotWindow.png', x: 580, y: 470, height: 96, width: 96 },
  { img: 'images/slotWindow.png', x: 690, y: 470, height: 96, width: 96 },
  { img: 'images/slotWindow.png', x: 800, y: 470, height: 96, width: 96 },
  { img: 'images/slotWindow.png', x: 910, y: 470, height: 96, width: 96 }];
  var shopSlot = [{ x: 580, y: 100, height: 96, width: 96 },
  { x: 690, y: 100, height: 96, width: 96 },
  { x: 800, y: 100, height: 96, width: 96 },
  { x: 910, y: 100, height: 96, width: 96 },
  { x: 580, y: 210, height: 96, width: 96 },
  { x: 690, y: 210, height: 96, width: 96 },
  { x: 800, y: 210, height: 96, width: 96 },
  { x: 910, y: 210, height: 96, width: 96 }
  ];


  slotWindowImg = new Image;
  slotWindowImg.src = slotWindow[0].img;
  heroAvatar = new Image;
  heroAvatar.src = 'images/knightAvatar.png';
  swordImg = new Image;
  swordImg.src = 'images/sword.png';

  ctx.font = '32px Tahoma';
  ctx.fillStyle = '#e67e22';   //marchewkowy 
  ctx.fillRect(0, 0, shop.width, shop.height);

  //character_info = gameApp.getCharacterInfo();
  async function get_my_profile_info() {
    character_info = await gameApp.getCharacterInfo();
    //ctx.clearRect(185, 625, 210, 40);
    ctx.drawImage(slotWindowImg,175, 625, 220, 40 );
    var playerMoney = 'Money: ' + character_info.gold + ' $';
    ctx.font = '600 30px Arial';
    ctx.fillStyle = "#fbc531";
    ctx.fillText(playerMoney, 185, 655);
  }

  for (var i = 0; i <= 7; i++) {
    ctx.drawImage(slotWindowImg, slotWindow[i].x, slotWindow[i].y, slotWindow[i].width, slotWindow[i].height);
    ctx.drawImage(slotWindowImg, shopSlot[i].x, shopSlot[i].y, shopSlot[i].width, shopSlot[i].height);
    shopDiv.innerHTML += '<div id="shopItem' + i + '" class="shopItem shopItem' + i + '"><img src="' + items[randomizedItems()].image + '" id="shopImg" class=""></div> ';
    shopDiv.innerHTML += '<div id="playerItem' + i + '" class="playerInventory playerItem' + i + '"></div> ';
  }

  var playerInventoryDOM = shopDiv.querySelectorAll('.playerInventory');


  init(); 


  ctx.fillStyle = '#ff9ff3';
  ctx.fillText('Marshall, the shopkeeper', 115, 266);

  testImg = new Image;
  testImg.src = 'images/Avatar.png';
  ctx.drawImage(testImg, 200, 100, 128, 128);

  ctx.drawImage(heroAvatar, 200, 485, 128, 128);


  function dragElement(elmnt, id) {
    var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    if (document.getElementById(elmnt.id + id)) {
      // if present, the shopView is where you move the DIV from:
      document.getElementBy(elmnt.id + id).onmousedown = dragMouseDown;
    } else {
      // otherwise, move the DIV from anywhere inside the DIV:
      elmnt.onmousedown = dragMouseDown;
    }

    function dragMouseDown(e) {
      e = e || window.event;
      e.preventDefault();
      // get the mouse cursor position at startup:
      pos3 = e.clientX;
      pos4 = e.clientY;
      document.onmouseup = closeDragElement;
      // call a function whenever the cursor moves:
      document.onmousemove = elementDrag;
    }

    function elementDrag(e) {
      e = e || window.event;
      e.preventDefault();
      // calculate the new cursor position:
      pos1 = pos3 - e.clientX;
      pos2 = pos4 - e.clientY;
      pos3 = e.clientX;
      pos4 = e.clientY;
      // set the element's new position:
      elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
      elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
    }

    function closeDragElement() {
      // stop moving when mouse button is released:
      document.onmouseup = null;
      document.onmousemove = null;
    }
  }


  /* Randomize items from 0 to 2 */

  function randomizedItems() {
    rng = Math.floor(Math.random() * 3);
    return rng;
  }

  async function setInventory(){
    //console.log("PRZED ZEBRANIEM DANYCH");
     playerInventory = await gameApp.getInventory();
     //console.log("PO ZEBRANIU DANYCH");
     //console.log(playerInventory);
     for(var i = 0; i<8 ; i++){
      if(playerInventory != undefined && playerInventory[i] != undefined){
        var playerItems = '<img src="' + items[playerInventory[i]].image + '" id="shopImg" class="' + playerInventory[i] + '">';
        playerInventoryDOM[i].innerHTML += playerItems;
        playerInventoryDOM[i].classList.add('taken');
        
      } else {

        
      }
    }
  }

  async function drawInventoryItems(){
   
  }

  function getItemId() {
    var imgDiv = shopDiv.querySelectorAll('#shopImg');
    var shopSlotDiv = shopDiv.querySelectorAll('.shopItem');
    for (var i = 0; i <= 7; i++) {
      if (imgDiv[i].getAttribute('src') == 'images/sword.png') {
        imgDiv[i].classList.add('0');
      } else if (imgDiv[i].getAttribute('src') == 'images/shield.png') {
        imgDiv[i].classList.add('1');
      } else if (imgDiv[i].getAttribute('src') == 'images/spear.png') {
        imgDiv[i].classList.add('2');
      }
    }

  }


  var emptySlot;
  var taken = false;

  function emptyPlayerSlot() {
    for (var slot in playerInventoryDOM) {
      if (slot < 8) {
        var inventory = playerInventoryDOM[slot];
        //console.log(inventory);
        if (inventory.className == 'playerInventory playerItem' + slot) {
          emptySlot = inventory;
          inventory.classList.add('taken');

          break;

        } else if (slot == 8) {
          var inventory = playerInventoryDOM[slot];
          //console.log(inventory);
          if (inventory.className == 'playerInventory playerItem' + slot) {
            emptySlot = inventory;
            //console.log(emptySlot);
            // console.log(inventory.className == 'playerInventory playerItem' + slot);
            console.log(emptySlot);
            inventory.classList.add('taken');
            taken = true;

            break;

          } else if (slot == 8 && taken) {
            break;
          }
        }
      }
    }
  }

  dragElement(document.getElementById("shopItem1"));
  dragElement(document.getElementById("shopItem2"));
  dragElement(document.getElementById("shopItem3"));

  var shopItems = document.querySelectorAll('.shopItem');

  /* Transfer item to the inventory slots */


  for (var id in shopItems) {
    var shopItem = shopItems[id];
    shopItems[id].addEventListener('click', function () {
      //  console.log(parseInt(this.children.shopImg.classList));   <== tp jest czyste id wyjÄ™tegp itemu od sklepikarza 
      //console.log('huj');
      var itemPrice = items[parseInt(this.children.shopImg.classList)].price;
      if (itemPrice <= character_info.gold) {
      var updatedGold = character_info.gold - itemPrice;
      gameApp.updateMoney(updatedGold);
      get_my_profile_info();
      emptyPlayerSlot();
      this.classList.add(emptySlot.id);
      gameApp.updateInventory((this.children.shopImg.classList.value));
      console.log((this.children.shopImg.classList.value));
      console.log( gameApp.updateInventory());
      } else 
      window.alert('you dont have enough money');
    }

    );



    /* Hover on item to see its stats  */

    shopItems[id].addEventListener('mouseover', function (event) {
      var itemId = this.children.shopImg.getAttribute('class');
      //statsWindow(event.clientX, event.clientY);
      // console.log(id);
      var itemDescription = 'Item stats = Attack: ' + items[itemId].atk + ' Def: ' + items[itemId].def + ' Price: ' + items[itemId].price + ' Speciality: ' + items[itemId].spec;
      // console.log('Item stats: attack: ' + items[itemId].atk + ' def: ' + items[itemId].def + ' price: ' + items[itemId].price + ' speciality: ' + items[itemId].spec);
      shopDiv.querySelector('.itemDescription').innerHTML = '<div><p>' + '* ' + items[itemId].name + ' *' + '</p><p> Attack: ' + items[itemId].atk + '</p> <p>  Defense: ' + items[itemId].def + '</p><p> Price: ' + items[itemId].price + '$</p><p> Sell: ' + Math.floor(items[itemId].price * 0.6) + '$</p><p> speciality: ' + items[itemId].spec + '</p></div>';
      this.addEventListener('mouseleave', function () {
        shopDiv.querySelector('.itemDescription').innerHTML = '<p>Hover items to see stats here!</p>';
      })
    });

    playerInventoryDOM[id].addEventListener('mouseover', function (event) {
      var itemId = this.children.shopImg.getAttribute('class');
      //statsWindow(event.clientX, event.clientY);
      // console.log(id);
      var itemDescription = 'Item stats = Attack: ' + items[itemId].atk + ' Def: ' + items[itemId].def + ' Price: ' + items[itemId].price + ' Speciality: ' + items[itemId].spec;
      // console.log('Item stats: attack: ' + items[itemId].atk + ' def: ' + items[itemId].def + ' price: ' + items[itemId].price + ' speciality: ' + items[itemId].spec);
      shopDiv.querySelector('.itemDescription').innerHTML = '<div><p>' + '* ' + items[itemId].name + ' *' + '</p><p> Attack: ' + items[itemId].atk + '</p> <p>  Defense: ' + items[itemId].def + '</p><p> Price: ' + items[itemId].price + '$</p><p> Sell: ' + Math.floor(items[itemId].price * 0.6) + '$</p><p> speciality: ' + items[itemId].spec + '</p></div>';
      this.addEventListener('mouseleave', function () {
        shopDiv.querySelector('.itemDescription').innerHTML = '<p>Hover items to see stats here!</p>';
      })
    });
  }

  function init(){
    getItemId();
  get_my_profile_info();
  setInventory();
  drawInventoryItems();

  }
  


</script>

<style>
  .itemDescription {
    position: absolute;
    left: 1080px;
    top: 170px;
    font-size: 34px;
  }

  .shopItem0 {
    position: absolute;
    left: 585px;
    top: 105px;
  }

  .shopItem1 {
    position: absolute;
    left: 695px;
    top: 105px;
  }

  .shopItem2 {
    position: absolute;
    left: 805px;
    top: 105px;
  }

  .shopItem3 {
    position: absolute;
    left: 915px;
    top: 105px;
  }

  .shopItem4 {
    position: absolute;
    left: 585px;
    top: 215px;
  }

  .shopItem5 {
    position: absolute;
    left: 695px;
    top: 215px;
  }

  .shopItem6 {
    position: absolute;
    left: 805px;
    top: 215px;
  }

  .shopItem7 {
    position: absolute;
    left: 915px;
    top: 215px;
  }

  .playerItem0 {
    position: absolute;
    left: 585px;
    top: 585px;
  }

  .playerItem1 {
    position: absolute;
    left: 695px;
    top: 585px;
  }

  .playerItem2 {
    position: absolute;
    left: 805px;
    top: 585px;
  }

  .playerItem3 {
    position: absolute;
    left: 915px;
    top: 585px;
  }

  .playerItem4 {
    position: absolute;
    left: 585px;
    top: 475px;
  }

  .playerItem5 {
    position: absolute;
    left: 695px;
    top: 475px;
  }

  .playerItem6 {
    position: absolute;
    left: 805px;
    top: 475px;
  }

  .playerItem7 {
    position: absolute;
    left: 915px;
    top: 475px;
  }

  .none {
    display: none;
  }
</style>